const fs = require('fs');
const path = require('path');
const csv = require('csvtojson');

// Path to CSV file
const csvFilePath = path.resolve(__dirname, 'Outscraper-20250309212621xs46_hvac_contractor - Generated by Outscraper Â© (1).csv');
const outputFilePath = path.resolve(__dirname, 'public/businesses.json');

// Stock images for defaults
const DEFAULT_HERO_IMAGE = 'https://images.unsplash.com/photo-1581094794329-c8112a89af12?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80';
const DEFAULT_ABOUT_IMAGE = 'https://images.unsplash.com/photo-1621905251189-08b45d6a269e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80';

// Default colors
const DEFAULT_PRIMARY_COLOR = '#0072CE';
const DEFAULT_SECONDARY_COLOR = '#ff7a00';

// Convert CSV to JSON
csv()
  .fromFile(csvFilePath)
  .then((jsonArray) => {
    // Process the data to create a trimmed version with only needed fields
    const businesses = jsonArray.map(item => {
      // Create slug from business name (lowercase, no special chars, spaces removed)
      const slug = item.name
        ? item.name.toLowerCase()
            .replace(/[^\w\s]/gi, '')
            .replace(/\s+/g, '')
        : '';
      
      // Extract needed fields
      return {
        slug,
        name: item.name || '',
        phone: item.phone || '',
        street: item.street || '',
        city: item.city || '',
        postal_code: item.postal_code || '',
        state: item.state || '',
        latitude: item.latitude || '',
        longitude: item.longitude || '',
        rating: item.rating || '',
        reviews: item.reviews || '',
        reviews_link: item.reviews_link || '',
        place_id: item.place_id || '',
        working_hours: item.working_hours || '',
        logo: item.logo || '',
        email: item.email_1 || '',
        facebook: item.facebook || '',
        
        // Customization options with defaults
        customization: {
          heroImage: item.photo || DEFAULT_HERO_IMAGE,
          aboutImage: DEFAULT_ABOUT_IMAGE,
          primaryColor: DEFAULT_PRIMARY_COLOR,
          secondaryColor: DEFAULT_SECONDARY_COLOR
        }
      };
    });

    // Write to JSON file
    fs.writeFileSync(outputFilePath, JSON.stringify(businesses, null, 2));
    console.log(`Created customizable business data at ${outputFilePath}`);
  })
  .catch(err => {
    console.error('Error converting CSV to JSON:', err);
  });