const fs = require('fs');
const csv = require('csvtojson');

const inputFile = '/workspaces/A/Outscraper-20250309212621xs46_hvac_contractor - Generated by Outscraper Â© (1) copy.csv';
const outputFile = '/workspaces/A/hvacbirmingham.json';

// Convert CSV to JSON preserving all fields
csv()
  .fromFile(inputFile)
  .then((jsonArray) => {
    // Create a map with business name slugs as keys
    const businessMap = {};
    
    jsonArray.forEach(business => {
      if (business.name) {
        // Create slug from business name (lowercase, no special chars, spaces removed)
        const slug = business.name
          .toLowerCase()
          .replace(/[^\w\s]/gi, '')
          .replace(/\s+/g, '');
        
        // Add business to map with all original fields preserved
        businessMap[slug] = business;
      }
    });
    
    // Write to file
    fs.writeFileSync(outputFile, JSON.stringify(businessMap, null, 2));
    console.log(`Converted CSV to JSON: ${outputFile}`);
  })
  .catch(err => {
    console.error('Error:', err);
  });